<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Meta Ads Creative Generator</title>
    <link rel="stylesheet" href="css/styles.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
    <style>
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        #initStatus {
            position: fixed;
            top: 20px;
            right: 20px;
            background: white;
            padding: 15px 20px;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            z-index: 10000;
            font-family: monospace;
            font-size: 12px;
        }
        #initStatus.hidden { display: none; }
    </style>
</head>
<body>
    <!-- Status d'initialisation -->
    <div id="initStatus">
        <div>‚è≥ Chargement de l'application...</div>
        <div id="statusDetails" style="margin-top:10px;color:#666;"></div>
    </div>

    <div class="app-container">
        <!-- Header -->
        <header class="app-header">
            <h1>üöÄ Meta Ads Creative Generator</h1>
            <p>Cr√©ez des cr√©atives qui convertissent pour vos campagnes Facebook & Instagram</p>
        </header>

        <!-- Navigation -->
        <div class="tabs">
            <button class="tab step-nav active" data-step="brand">
                <i class="fas fa-building"></i> Marque
            </button>
            <button class="tab step-nav" data-step="images">
                <i class="fas fa-images"></i> Images
            </button>
            <button class="tab step-nav" data-step="content">
                <i class="fas fa-edit"></i> Contenu
            </button>
            <button class="tab step-nav" data-step="templates">
                <i class="fas fa-layer-group"></i> Templates
            </button>
            <button class="tab step-nav" data-step="preview">
                <i class="fas fa-eye"></i> Pr√©visualisation
            </button>
        </div>

        <!-- SECTION 1: Brand Setup -->
        <section id="brandSection" class="step-section">
            <h2><i class="fas fa-building"></i> Configuration de la Marque</h2>
            
            <div class="btn-group mb-4">
                <button id="scrapeWebsite" class="btn btn-secondary">
                    <i class="fas fa-download"></i> Scraper depuis un site web
                </button>
                <div id="savedBrands" style="display:inline-block;margin-left:20px;"></div>
            </div>
            
            <form id="brandForm" class="form-grid">
                <div class="form-group">
                    <label>Nom de la marque *</label>
                    <input type="text" id="brandName" name="brandName" required>
                </div>
                
                <div class="form-group">
                    <label>Site web</label>
                    <input type="url" id="websiteUrl" name="websiteUrl" placeholder="https://example.com">
                </div>
                
                <div class="form-group">
                    <label>Industrie</label>
                    <select id="industry" name="industry">
                        <option value="">S√©lectionner</option>
                        <option value="ecommerce">E-commerce</option>
                        <option value="saas">SaaS</option>
                        <option value="fashion">Mode</option>
                        <option value="food">Alimentation</option>
                        <option value="tech">Technologie</option>
                        <option value="health">Sant√©</option>
                        <option value="education">√âducation</option>
                        <option value="services">Services</option>
                    </select>
                </div>
                
                <div class="form-group">
                    <label>Audience cible</label>
                    <input type="text" id="targetAudience" name="targetAudience" placeholder="Ex: Femmes 25-35 ans">
                </div>
                
                <div class="form-group" style="grid-column:span 2;">
                    <label>Couleurs de la marque</label>
                    <div style="display:grid;grid-template-columns:repeat(5,1fr);gap:15px;">
                        <div>
                            <label style="font-size:12px;">Primaire</label>
                            <input type="color" id="primaryColor" name="primaryColor" value="#1877F2">
                        </div>
                        <div>
                            <label style="font-size:12px;">Secondaire</label>
                            <input type="color" id="secondaryColor" name="secondaryColor" value="#42B883">
                        </div>
                        <div>
                            <label style="font-size:12px;">Accent</label>
                            <input type="color" id="accentColor" name="accentColor" value="#667eea">
                        </div>
                        <div>
                            <label style="font-size:12px;">Texte</label>
                            <input type="color" id="textColor" name="textColor" value="#1C1E21">
                        </div>
                        <div>
                            <label style="font-size:12px;">Fond</label>
                            <input type="color" id="backgroundColor" name="backgroundColor" value="#FFFFFF">
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label>Police de titre</label>
                    <input type="text" id="headingFont" name="headingFont" value="Inter">
                </div>
                
                <div class="form-group">
                    <label>Police de texte</label>
                    <input type="text" id="bodyFont" name="bodyFont" value="Inter">
                </div>
                
                <div class="form-group" style="grid-column:span 2;">
                    <label>Call-to-Actions (s√©par√©s par des virgules)</label>
                    <input type="text" id="ctas" name="ctas" placeholder="En savoir plus, Acheter maintenant, D√©couvrir">
                </div>
            </form>
            
            <div class="btn-group">
                <button type="submit" form="brandForm" class="btn btn-primary">
                    <i class="fas fa-save"></i> Sauvegarder et continuer
                </button>
            </div>
        </section>

        <!-- SECTION 2: Images -->
        <section id="imagesSection" class="step-section hidden">
            <h2><i class="fas fa-images"></i> Gestion des Images</h2>
            
            <div class="form-grid">
                <div>
                    <h3>Upload d'images</h3>
                    <div id="uploadZone" class="upload-zone">
                        <i class="fas fa-cloud-upload-alt"></i>
                        <p>Glissez-d√©posez ou cliquez pour t√©l√©charger</p>
                        <p style="font-size:12px;opacity:0.7;">JPG, PNG, GIF, WebP (Max: 5MB)</p>
                    </div>
                </div>
                
                <div>
                    <h3>G√©n√©ration IA</h3>
                    <button id="generateAiImage" class="btn btn-primary" style="width:100%;">
                        <i class="fas fa-magic"></i> G√©n√©rer avec l'IA
                    </button>
                </div>
            </div>
            
            <div class="image-gallery" id="imageGallery">
                <!-- Images will be displayed here -->
            </div>
            
            <div id="selectedImagePreview" style="margin-top:20px;text-align:center;">
                <!-- Selected image preview -->
            </div>
        </section>

        <!-- Autres sections... (simplifi√©es pour le test) -->
        <section id="contentSection" class="step-section hidden">
            <h2><i class="fas fa-edit"></i> Contenu (En cours de chargement...)</h2>
        </section>

        <section id="templatesSection" class="step-section hidden">
            <h2><i class="fas fa-layer-group"></i> Templates (En cours de chargement...)</h2>
        </section>

        <section id="previewSection" class="step-section hidden">
            <h2><i class="fas fa-eye"></i> Pr√©visualisation (En cours de chargement...)</h2>
        </section>
    </div>

    <!-- Loading Overlay -->
    <div id="loadingOverlay" style="display:none;position:fixed;top:0;left:0;right:0;bottom:0;background:rgba(0,0,0,0.5);z-index:9999;">
        <div style="position:absolute;top:50%;left:50%;transform:translate(-50%,-50%);text-align:center;">
            <div class="spinner" style="width:40px;height:40px;border:4px solid #E5E7EB;border-top-color:#667eea;border-radius:50%;animation:spin 1s linear infinite;margin:0 auto;"></div>
            <p style="color:white;margin-top:20px;">Chargement...</p>
        </div>
    </div>

    <!-- Scripts avec gestion d'erreurs -->
    <script>
        const statusDiv = document.getElementById('statusDetails');
        const initStatus = document.getElementById('initStatus');
        
        function updateStatus(message, isError = false) {
            console.log(message);
            const line = document.createElement('div');
            line.textContent = message;
            line.style.color = isError ? '#F02849' : '#42B883';
            statusDiv.appendChild(line);
        }
        
        function loadScript(src, name) {
            return new Promise((resolve, reject) => {
                updateStatus(`‚è≥ Chargement ${name}...`);
                const script = document.createElement('script');
                script.src = src;
                script.onload = () => {
                    updateStatus(`‚úÖ ${name} charg√©`);
                    resolve();
                };
                script.onerror = () => {
                    updateStatus(`‚ùå Erreur ${name}`, true);
                    reject(new Error(`Failed to load ${src}`));
                };
                document.head.appendChild(script);
            });
        }
        
        // Charger les scripts s√©quentiellement
        async function initApp() {
            try {
                await loadScript('js/brandManager.js', 'BrandManager');
                await loadScript('js/templates.js', 'Templates');
                await loadScript('js/imageHandler.js', 'ImageHandler');
                await loadScript('js/creativeGenerator.js', 'CreativeGenerator');
                await loadScript('js/app.js', 'App Principal');
                
                updateStatus('‚úÖ Application pr√™te !');
                
                // Cacher le status apr√®s 3 secondes
                setTimeout(() => {
                    initStatus.classList.add('hidden');
                }, 3000);
                
            } catch (error) {
                updateStatus(`‚ùå Erreur fatale: ${error.message}`, true);
                alert('Erreur de chargement. V√©rifiez la console (F12) pour plus de d√©tails.');
            }
        }
        
        // Helper function for template format switching
        function showTemplateFormat(format) {
            document.querySelectorAll('.template-grid').forEach(grid => {
                grid.classList.add('hidden');
            });
            document.getElementById(`${format}Templates`)?.classList.remove('hidden');
            
            document.querySelectorAll('#templatesSection .tabs .tab').forEach(tab => {
                tab.classList.remove('active');
            });
            event.target.classList.add('active');
        }
        
        // D√©marrer le chargement
        if (document.readyState === 'loading') {
            document.addEventListener('DOMContentLoaded', initApp);
        } else {
            initApp();
        }
    </script>
</body>
</html>
